# Переводчик

## Назначение
Проект "Переводчик" представляет собой минималистичное десктопное приложение для Windows, служащее оболочкой для работы с различными нейросетевыми моделями перевода. Основной документ, описывающий функциональность и требования, находится в файле [combined_specification.md](combined_specification.md).

## Функции
- Поддержка нескольких моделей перевода и выбор нужной модели.
- Навигация по главам, пакетный перевод и сохранение в форматы DOCX и TXT.
- Создание и управление глоссарием, предложения синонимов.
- Подсветка различий, история версий, отмена/повтор.
- Секундомер, экспорт статистики, автоматический переход к следующей главе.
- Панель настроек (API-ключи, цвета, размер шрифта, проверка машинного перевода).
- Механизм автообновления и автоматическая установка зависимостей (`run.py`).

## Рабочий процесс

### Перевод по главам
1. Укажите папки с оригиналом и переводом – приложение сканирует облако и загружает первую главу.
2. Перед отправкой запроса можно отредактировать мини‑промпт; перевод отображается справа и доступен для правок.
3. После редактирования результат автоматически сохраняется по шаблону и при необходимости открывается следующая глава.

### Применение глоссариев
Создайте глоссарий из пар слов; выбранные пары автоматически вставляются в мини‑промпт и повышают точность перевода.

### Контекстные синонимы
По клику на слово система анализирует контекст, предлагает список синонимов и при желании использует нейросеть для анализа.

Автосохранение выполняется после перевода, различия с исходным текстом подсвечиваются, а кнопка «Перевести все» запускает пакетный перевод нескольких глав.

### Проекты и аналитика
Проекты можно создавать, переименовывать и переносить в архив, а при сохранении главы фиксируются символы и время, что позволяет отслеживать прогресс и формировать отчёты.

## Структура документов
- `combined_specification.md` — актуальная объединённая спецификация проекта.
- `спецификация_переводчик_десктопное_приложение (2).md`, `спецификация_переводчик_десктопное_приложение (3).md`, `спецификация_переводчик_десктопное_приложение (4).md` — ранние версии спецификации и дополнительные материалы.
- `переводчик.zip` — архив с исходными файлами проекта.

## Архитектура
- `app/ui_main.py` — главное окно; управляет таймерами, подсветкой различий и интерфейсом глоссария.
- `app/models/` — клиенты переводчиков (`DeepLTranslator`, `GeminiTranslator`, `GrokTranslator`, `QwenTranslator`).
- `app/services/` — вспомогательные модули (`synonyms.py`, `cloud.py`, `versioning.py`) для синонимов, облака и версионирования.
- `app/settings.py` — хранение конфигурации и диалог настроек.

Во время перевода `ui_main.py` считывает параметры из `settings.py`, обращается к выбранному клиенту из `models` и использует сервисы для предложений, синхронизации и истории изменений.

## Поддерживаемые модели
Приложение умеет работать с несколькими LLM и сервисами перевода:

- **Gemini**
- **DeepL**
- **Grok**
- **Qwen**
API-ключи для всех сервисов хранятся в объекте `AppSettings` (`gemini_key`, `deepl_key`, `grok_key`, `qwen_key`). Функция `get_translator()` читает настройку `model` и инициализирует соответствующий клиент с нужным ключом.

### Переключение модели
```python
from app.settings import AppSettings
from app.models import get_translator

settings = AppSettings.load()
settings.model = "grok"  # выбор модели
settings.save()

translator = get_translator(settings.model, settings)
```

## Глоссарий и синонимы
Глоссарии хранятся в виде JSON‑файлов в папке `glossaries`, путь к которой задаётся в настройках. Табличный интерфейс позволяет создавать, переименовывать, импортировать и редактировать записи; количество пар слов не ограничено.

Настройка `synonym_provider` определяет источник подсказок. Значение `model` использует функцию `fetch_synonyms_llm` и обращается к выбранной нейросетевой модели, а `datamuse` — `fetch_synonyms` с открытым API Datamuse.

Для `model` (`fetch_synonyms_llm`) выполняется инициализация переводчика через `get_translator`, формируется промпт, затем полученный ответ разбирается в список синонимов. Для `datamuse` (`fetch_synonyms`) строится HTTP‑запрос к сервису Datamuse, читается JSON‑ответ и обрабатываются возможные ошибки. Готовый список возвращается в интерфейс, где пользователь выбирает нужный вариант.

Чтобы задействовать глоссарий:

1. Откройте панель глоссария, создайте или импортируйте файл и добавьте пары слов.
2. Отметьте пункт «Вставлять в мини‑промпт» — при переводе все пары автоматически добавятся к мини‑промпту.
3. В редакторе перевода при необходимости копируйте термины из таблицы или заменяйте ими существующие слова для сохранения единообразия.

## Шрифты и иконки
Все используемые шрифты и графические элементы хранятся в корне репозитория:
- Шрифты: `Cattedrale[RUSbypenka220]-Regular.ttf`, `Inter-VariableFont_opsz,wght.ttf`.
- Иконки и изображения: `сохранить.png`, `настройки.png`, `лого.jpg`, `лого 1.jpg`, `лого 2.png`.
 
## Настройки
В диалоге настроек можно выбрать цвет и интенсивность неонового свечения активных полей.
Также можно задать прокси-сервер, если прямой доступ к сервисам ограничен.
Выбранные параметры применяются сразу после сохранения.

## Интеграция с Google Docs
Приложение умеет работать с документами в облаке. Для этого в объекте
`AppSettings` используются поля `gdoc_token` (OAuth‑токен) и
`gdoc_folder_id` (ID папки Google Drive с главами).

В модуле [`app/services/cloud.py`](app/services/cloud.py) реализованы
функции:

- `list_documents(token, folder_id)` — получить список файлов в папке;
- `load_document(token, doc_id)` — загрузить текст выбранного документа;
- `save_document(token, doc_id, text)` — перезаписать содержимое.

### Настройка
1. В Google Cloud Console включите API Google Drive и Google Docs.
2. Создайте OAuth‑клиент и выполните авторизацию, получив токен.
3. Сохраните токен и путь к нему укажите в `gdoc_token` (например,
   `settings.ini` или диалог настроек).
4. Скопируйте ID папки с главами и задайте его в `gdoc_folder_id`.

После этого список документов Google Docs будет доступен в приложении и
изменения будут синхронизироваться обратно в облако.

## Региональные ограничения
Сервис Gemini доступен не во всех странах. При появлении ошибки `User location is not supported` подключитесь через поддерживаемый регион или настройте прокси в параметрах приложения.

## Windows/MINGW64
В среде MINGW64 после создания виртуального окружения командой:

```bash
python -m venv venv
```

его можно активировать командой:

```bash
source venv/Scripts/activate
```

## Запуск

Перед запуском убедитесь, что переменная окружения `QT_QPA_PLATFORM` не имеет значения `offscreen`.
Если она установлена, удалите её или задайте `windows`, иначе графический интерфейс не будет показан.

Для автоматической установки зависимостей выполните:

```bash
python run.py
```

После установки зависимостей приложение можно запускать командой:

```bash
python -m app.main
```

При необходимости зависимости можно установить заранее командой:

```bash
pip install -r requirements.txt
```

## Лицензия
Этот проект распространяется по лицензии MIT. Подробности см. в файле [LICENSE](LICENSE).
